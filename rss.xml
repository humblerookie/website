<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Anvith Bhat | My Blog]]></title><description><![CDATA[I'm passionate about creating stuff around android. Be vary, observations are interlaced with humor.]]></description><link>http://github.com/dylang/node-rss</link><generator>GatsbyJS</generator><lastBuildDate>Thu, 16 Jul 2020 08:54:44 GMT</lastBuildDate><item><title><![CDATA[Avoid racing with Rx Subjects & TestScheduler]]></title><description><![CDATA[We all use Rxjava in android and write tests, this article highlights a particular race condition which you may encounter.]]></description><link>https://lumen.netlify.com/posts/avoid-racing-subjects-and-testscheduler/</link><guid isPermaLink="false">https://lumen.netlify.com/posts/avoid-racing-subjects-and-testscheduler/</guid><pubDate>Fri, 30 Nov 2018 16:51:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;img src=&quot;https://miro.medium.com/max/1650/0*tNRIRcp5pq8aHSrx&quot; alt=&quot;Banner graphic RXjava and Android&quot;&gt;&lt;/p&gt;
&lt;p&gt;RX is a great spell but at times certain things can make you wish you had more hair on your head if you miss out on some fundamentals. Here’s one of my ‘GOTCHA’ moments.&lt;/p&gt;
&lt;p&gt;After spending about a day or so trying to figure out why a simple test kept failing, a man was frustrated.&lt;/p&gt;
&lt;p&gt;&lt;div id=&quot;gist93321026&quot; class=&quot;gist&quot;&gt;
    &lt;div class=&quot;gist-file&quot;&gt;
      &lt;div class=&quot;gist-data&quot;&gt;
        &lt;div class=&quot;js-gist-file-update-container js-task-list-container file-box&quot;&gt;
  &lt;div id=&quot;file-hairpullingtest-kt&quot; class=&quot;file&quot;&gt;
    

  &lt;div itemprop=&quot;text&quot; class=&quot;Box-body p-0 blob-wrapper data type-kotlin &quot;&gt;
      
&lt;table class=&quot;highlight tab-size js-file-line-container&quot; data-tab-size=&quot;8&quot; data-paste-markdown-skip&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-L1&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;1&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-LC1&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-k&quot;&gt;@RunWith&lt;/span&gt;(&lt;span class=&quot;pl-en&quot;&gt;MockitoJUnitRunner&lt;/span&gt;::&lt;span class=&quot;pl-c1&quot;&gt;class&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-L2&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;2&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-LC2&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;HairPullingTest&lt;/span&gt; {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-L3&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;3&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-LC3&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;
&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-L4&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;4&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-LC4&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-k&quot;&gt;private&lt;/span&gt;  &lt;span class=&quot;pl-k&quot;&gt;var&lt;/span&gt; testScheduler &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;TestScheduler&lt;/span&gt;()&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-L5&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;5&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-LC5&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-k&quot;&gt;@Test&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-L6&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;6&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-LC6&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;testVodoo&lt;/span&gt;() {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-L7&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;7&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-LC7&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-k&quot;&gt;val&lt;/span&gt; subject&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;pl-en&quot;&gt;PublishSubject&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;pl-c1&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;PublishSubject&lt;/span&gt;.create()&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-L8&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;8&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-LC8&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-k&quot;&gt;val&lt;/span&gt; testObserver &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; subject&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-L9&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;9&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-LC9&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            .subscribeOn(testScheduler)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-L10&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;10&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-LC10&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            .observeOn(testScheduler)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-L11&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;11&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-LC11&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            .test()&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-L12&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;12&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-LC12&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        subject.onNext(&lt;span class=&quot;pl-c1&quot;&gt;1&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-L13&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;13&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-LC13&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        testScheduler.triggerActions()&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-L14&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;14&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-LC14&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        testObserver.assertValueCount(&lt;span class=&quot;pl-c1&quot;&gt;1&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-L15&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;15&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-LC15&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    }&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-L16&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;16&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtest-kt-LC16&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;}&lt;/td&gt;
      &lt;/tr&gt;
&lt;/table&gt;


  &lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;

      &lt;/div&gt;
      &lt;div class=&quot;gist-meta&quot;&gt;
        &lt;a href=&quot;https://gist.github.com/humblerookie/de2044feef32a0eb113c4cf7cf5e383d/raw/94959e94f09b50bcdea6834b045d4c9ee37f6290/HairPullingTest.kt&quot; style=&quot;float:right&quot;&gt;view raw&lt;/a&gt;
        &lt;a href=&quot;https://gist.github.com/humblerookie/de2044feef32a0eb113c4cf7cf5e383d#file-hairpullingtest-kt&quot;&gt;HairPullingTest.kt&lt;/a&gt;
        hosted with &amp;#10084; by &lt;a href=&quot;https://github.com&quot;&gt;GitHub&lt;/a&gt;
      &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;Fast forward he also realised something weird&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Substituting Subject with an Observable passes the test.&lt;/li&gt;
&lt;li&gt;Replacing the TestScheduler with a Trampoline scheduler also passes the test.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;So something unusual is up, so he heads over to &lt;a href=&quot;https://stackoverflow.com/questions/53519339/issue-with-publishsubject-and-testscheduler-item-isnt-emitted&quot;&gt;StackOverflow&lt;/a&gt;
and with some help from Dávid Karnok adds an assert statement.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://miro.medium.com/max/4228/1*tGnTJBwTIjgLpTp2uPCClg.png&quot; alt=&quot;Banner graphic test 1&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://media.giphy.com/media/CDJo4EgHwbaPS/source.gif&quot; alt=&quot;WTF&quot;&gt;&lt;/p&gt;
&lt;p&gt;So a man goes about adding logs to his test.&lt;/p&gt;
&lt;p&gt;&lt;div id=&quot;gist93321148&quot; class=&quot;gist&quot;&gt;
    &lt;div class=&quot;gist-file&quot;&gt;
      &lt;div class=&quot;gist-data&quot;&gt;
        &lt;div class=&quot;js-gist-file-update-container js-task-list-container file-box&quot;&gt;
  &lt;div id=&quot;file-hairpullingtestlogged-kt&quot; class=&quot;file&quot;&gt;
    

  &lt;div itemprop=&quot;text&quot; class=&quot;Box-body p-0 blob-wrapper data type-kotlin &quot;&gt;
      
&lt;table class=&quot;highlight tab-size js-file-line-container&quot; data-tab-size=&quot;8&quot; data-paste-markdown-skip&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-L1&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;1&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-LC1&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-k&quot;&gt;@RunWith&lt;/span&gt;(&lt;span class=&quot;pl-en&quot;&gt;MockitoJUnitRunner&lt;/span&gt;::&lt;span class=&quot;pl-c1&quot;&gt;class&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-L2&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;2&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-LC2&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;HairPullingTest&lt;/span&gt; {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-L3&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;3&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-LC3&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;
&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-L4&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;4&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-LC4&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-k&quot;&gt;private&lt;/span&gt;  &lt;span class=&quot;pl-k&quot;&gt;var&lt;/span&gt; testScheduler &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;TestScheduler&lt;/span&gt;()&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-L5&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;5&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-LC5&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-k&quot;&gt;@Test&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-L6&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;6&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-LC6&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;testVodoo&lt;/span&gt;() {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-L7&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;7&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-LC7&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-k&quot;&gt;val&lt;/span&gt; subject&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;pl-en&quot;&gt;PublishSubject&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;pl-c1&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;PublishSubject&lt;/span&gt;.create()&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-L8&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;8&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-LC8&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-k&quot;&gt;val&lt;/span&gt; testObserver &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; subject&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-L9&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;9&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-LC9&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            .subscribeOn(testScheduler)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-L10&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;10&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-LC10&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            .observeOn(testScheduler)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-L11&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;11&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-LC11&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            .doOnSubscribe {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-L12&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;12&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-LC12&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                &lt;span class=&quot;pl-c1&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;quot;&lt;/span&gt;I&amp;#39;ve subscribed&lt;span class=&quot;pl-pds&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-L13&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;13&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-LC13&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            }.test()&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-L14&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;14&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-LC14&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-c1&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&amp;quot;&lt;/span&gt;Emitting Item&lt;span class=&quot;pl-pds&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-L15&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;15&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-LC15&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        subject.onNext(&lt;span class=&quot;pl-c1&quot;&gt;1&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-L16&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;16&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-LC16&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        testScheduler.triggerActions()&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-L17&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;17&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-LC17&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        testObserver.assertValueCount(&lt;span class=&quot;pl-c1&quot;&gt;1&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-L18&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;18&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-LC18&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    }&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-L19&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;19&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestlogged-kt-LC19&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;}&lt;/td&gt;
      &lt;/tr&gt;
&lt;/table&gt;


  &lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;

      &lt;/div&gt;
      &lt;div class=&quot;gist-meta&quot;&gt;
        &lt;a href=&quot;https://gist.github.com/humblerookie/9ff1f62c0d08078d5538b0775a82ddba/raw/95d4456dc22186572535cc791d4d612261f77b90/HairPullingTestLogged.kt&quot; style=&quot;float:right&quot;&gt;view raw&lt;/a&gt;
        &lt;a href=&quot;https://gist.github.com/humblerookie/9ff1f62c0d08078d5538b0775a82ddba#file-hairpullingtestlogged-kt&quot;&gt;HairPullingTestLogged.kt&lt;/a&gt;
        hosted with &amp;#10084; by &lt;a href=&quot;https://github.com&quot;&gt;GitHub&lt;/a&gt;
      &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;and…&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://miro.medium.com/max/4784/1*lY_TJBqq7LDISWyrkCQUCQ.png&quot; alt=&quot;Questionable output&quot;&gt;&lt;/p&gt;
&lt;p&gt;So what’s really happening here?&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://miro.medium.com/max/1000/1*ZcpcCH-0QNJJOKCw0fz_sg.gif&quot; alt=&quot;Everybody lies&quot;&gt;&lt;/p&gt;
&lt;p&gt;Turns out the actual subscription(&lt;em&gt;subscribeActual()&lt;/em&gt; method in &lt;em&gt;PublishSubject&lt;/em&gt;) which adds the subscriber to Subject’s list of subscribers doesn’t happen until &lt;em&gt;triggerActions&lt;/em&gt; is invoked on the &lt;strong&gt;TestScheduler&lt;/strong&gt;. This results in a race condition where even though the subscriber seems subscribed, the actual subscription and emission happen concurrently. The emission is therefore ignored due to absence of any subscribers.&lt;/p&gt;
&lt;p&gt;The solution is to invoke &lt;em&gt;triggerActions&lt;/em&gt; immediately after subscribing and then again after emission.&lt;/p&gt;
&lt;p&gt;&lt;div id=&quot;gist93321226&quot; class=&quot;gist&quot;&gt;
    &lt;div class=&quot;gist-file&quot;&gt;
      &lt;div class=&quot;gist-data&quot;&gt;
        &lt;div class=&quot;js-gist-file-update-container js-task-list-container file-box&quot;&gt;
  &lt;div id=&quot;file-hairpullingtestsolution-kt&quot; class=&quot;file&quot;&gt;
    

  &lt;div itemprop=&quot;text&quot; class=&quot;Box-body p-0 blob-wrapper data type-kotlin &quot;&gt;
      
&lt;table class=&quot;highlight tab-size js-file-line-container&quot; data-tab-size=&quot;8&quot; data-paste-markdown-skip&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-L1&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;1&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-LC1&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-k&quot;&gt;@RunWith&lt;/span&gt;(&lt;span class=&quot;pl-en&quot;&gt;MockitoJUnitRunner&lt;/span&gt;::&lt;span class=&quot;pl-c1&quot;&gt;class&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-L2&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;2&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-LC2&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;DemoViewModelTest&lt;/span&gt; {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-L3&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;3&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-LC3&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;
&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-L4&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;4&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-LC4&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;var&lt;/span&gt; testScheduler &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;TestScheduler&lt;/span&gt;()&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-L5&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;5&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-LC5&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-k&quot;&gt;@Test&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-L6&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;6&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-LC6&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    &lt;span class=&quot;pl-k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;testVodoo&lt;/span&gt;() {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-L7&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;7&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-LC7&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-k&quot;&gt;val&lt;/span&gt; subject&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;PublishSubject&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;pl-c1&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;PublishSubject&lt;/span&gt;.create()&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-L8&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;8&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-LC8&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-k&quot;&gt;val&lt;/span&gt; testObserver &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; subject&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-L9&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;9&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-LC9&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            .subscribeOn(testScheduler)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-L10&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;10&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-LC10&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            .observeOn(testScheduler)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-L11&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;11&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-LC11&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            .test()&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-L12&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;12&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-LC12&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        testScheduler.triggerActions()&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-L13&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;13&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-LC13&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        subject.onNext(&lt;span class=&quot;pl-c1&quot;&gt;1&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-L14&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;14&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-LC14&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        testScheduler.triggerActions()&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-L15&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;15&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-LC15&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        testObserver.assertValueCount(&lt;span class=&quot;pl-c1&quot;&gt;1&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-L16&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;16&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-LC16&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    }&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-L17&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;17&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-hairpullingtestsolution-kt-LC17&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;}&lt;/td&gt;
      &lt;/tr&gt;
&lt;/table&gt;


  &lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;

      &lt;/div&gt;
      &lt;div class=&quot;gist-meta&quot;&gt;
        &lt;a href=&quot;https://gist.github.com/humblerookie/cbe4d2acd488d2c074fe708b0be50ff5/raw/cc6ac26117a3c31b2f9f8a28f06e8c6053cb5f02/HairPullingTestSolution.kt&quot; style=&quot;float:right&quot;&gt;view raw&lt;/a&gt;
        &lt;a href=&quot;https://gist.github.com/humblerookie/cbe4d2acd488d2c074fe708b0be50ff5#file-hairpullingtestsolution-kt&quot;&gt;HairPullingTestSolution.kt&lt;/a&gt;
        hosted with &amp;#10084; by &lt;a href=&quot;https://github.com&quot;&gt;GitHub&lt;/a&gt;
      &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;
&lt;h1&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;Always add an extra &lt;em&gt;triggerAction()&lt;/em&gt; with your &lt;strong&gt;TestScheduler&lt;/strong&gt; right after subscribing your subjects to ensure the subsequent emission happen as intended.&lt;/p&gt;</content:encoded></item></channel></rss>